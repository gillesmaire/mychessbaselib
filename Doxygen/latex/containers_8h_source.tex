\hypertarget{containers_8h_source}{}\doxysection{containers.\+h}
\mbox{\hyperlink{containers_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{\# Copyright (C) 2014-\/2017 Fulvio Benini}}
\DoxyCodeLine{3 \textcolor{comment}{}}
\DoxyCodeLine{4 \textcolor{comment}{* This file is part of Scid (Shane's Chess Information Database).}}
\DoxyCodeLine{5 \textcolor{comment}{*}}
\DoxyCodeLine{6 \textcolor{comment}{* Scid is free software: you can redistribute it and/or modify}}
\DoxyCodeLine{7 \textcolor{comment}{* it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{8 \textcolor{comment}{* the Free Software Foundation.}}
\DoxyCodeLine{9 \textcolor{comment}{*}}
\DoxyCodeLine{10 \textcolor{comment}{* Scid is distributed in the hope that it will be useful,}}
\DoxyCodeLine{11 \textcolor{comment}{* but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{12 \textcolor{comment}{* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the}}
\DoxyCodeLine{13 \textcolor{comment}{* GNU General Public License for more details.}}
\DoxyCodeLine{14 \textcolor{comment}{*}}
\DoxyCodeLine{15 \textcolor{comment}{* You should have received a copy of the GNU General Public License}}
\DoxyCodeLine{16 \textcolor{comment}{* along with Scid. If not, see <http://www.gnu.org/licenses/>.}}
\DoxyCodeLine{17 \textcolor{comment}{*/}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#ifndef CONTAINERS\_H}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define CONTAINERS\_H}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{25 }
\DoxyCodeLine{34 \textcolor{keyword}{template} <\textcolor{keyword}{class} TElem, \textcolor{keywordtype}{size\_t} UNDOMAX> \textcolor{keyword}{class }\mbox{\hyperlink{class_undo_redo}{UndoRedo}} \{}
\DoxyCodeLine{35     std::vector<TElem*> undo\_;}
\DoxyCodeLine{36     std::vector<TElem*> redo\_;}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{keyword}{public}:}
\DoxyCodeLine{39     \mbox{\hyperlink{class_undo_redo_a1f678931b2fbf08d01fe0c84b9e89c66}{\string~UndoRedo}}() \{ \mbox{\hyperlink{class_undo_redo_ac64d90357e198bf6ac05c69d4617083d}{clear}}(); \}}
\DoxyCodeLine{40     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_undo_redo_ac64d90357e198bf6ac05c69d4617083d}{clear}}() \{}
\DoxyCodeLine{41         \mbox{\hyperlink{class_undo_redo_ac64d90357e198bf6ac05c69d4617083d}{clear}}(undo\_);}
\DoxyCodeLine{42         \mbox{\hyperlink{class_undo_redo_ac64d90357e198bf6ac05c69d4617083d}{clear}}(redo\_);}
\DoxyCodeLine{43     \}}
\DoxyCodeLine{44     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{class_undo_redo_a03867ba20d3e1e9db24a48349b9192e8}{undoSize}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} undo\_.size(); \}}
\DoxyCodeLine{45     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{class_undo_redo_a525c34fa3944034390fcfdf845e37ddd}{redoSize}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} redo\_.size(); \}}
\DoxyCodeLine{46 }
\DoxyCodeLine{52     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_undo_redo_a147a763baaabfb663c4fcaf0d775479f}{store}}(TElem* current) \{}
\DoxyCodeLine{53         \mbox{\hyperlink{class_undo_redo_ac64d90357e198bf6ac05c69d4617083d}{clear}}(redo\_);}
\DoxyCodeLine{54         undo\_.push\_back(current-\/>clone());}
\DoxyCodeLine{55         \textcolor{keywordflow}{if} (undo\_.size() > UNDOMAX) \{}
\DoxyCodeLine{56             \textcolor{keyword}{delete} undo\_.front();}
\DoxyCodeLine{57             undo\_.erase(undo\_.begin());}
\DoxyCodeLine{58         \}}
\DoxyCodeLine{59     \}}
\DoxyCodeLine{60 }
\DoxyCodeLine{68     TElem* \mbox{\hyperlink{class_undo_redo_aacdf8b1b785386af5e89cba4b96a51bc}{undo}}(TElem* current) \{ \textcolor{keywordflow}{return} doUndoRedo(undo\_, redo\_, current); \}}
\DoxyCodeLine{69 }
\DoxyCodeLine{77     TElem* \mbox{\hyperlink{class_undo_redo_a0338ea55973d97f614b36a67a3d8101c}{redo}}(TElem* current) \{ \textcolor{keywordflow}{return} doUndoRedo(redo\_, undo\_, current); \}}
\DoxyCodeLine{78 }
\DoxyCodeLine{79 \textcolor{keyword}{private}:}
\DoxyCodeLine{80     \textcolor{comment}{// Store current into cont2; remove and return the last element of cont1}}
\DoxyCodeLine{81     \textcolor{keyword}{template} <\textcolor{keyword}{typename} TCont>}
\DoxyCodeLine{82     TElem* doUndoRedo(TCont\& cont1, TCont\& cont2, TElem* current) \{}
\DoxyCodeLine{83         \textcolor{keywordflow}{if} (cont1.empty())}
\DoxyCodeLine{84             \textcolor{keywordflow}{return} current;}
\DoxyCodeLine{85 }
\DoxyCodeLine{86         \textcolor{keywordflow}{if} (cont2.empty() || cont2.back() != current)}
\DoxyCodeLine{87             cont2.push\_back(current);}
\DoxyCodeLine{88 }
\DoxyCodeLine{89         \textcolor{keyword}{auto} res = cont1.back();}
\DoxyCodeLine{90         cont1.pop\_back();}
\DoxyCodeLine{91         \textcolor{keywordflow}{return} res;}
\DoxyCodeLine{92     \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \textcolor{keyword}{template} <\textcolor{keyword}{typename} TCont> \textcolor{keywordtype}{void} \mbox{\hyperlink{class_undo_redo_ac64d90357e198bf6ac05c69d4617083d}{clear}}(TCont\& cont) \{}
\DoxyCodeLine{95         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& e : cont)}
\DoxyCodeLine{96             \textcolor{keyword}{delete} e;}
\DoxyCodeLine{97         cont.clear();}
\DoxyCodeLine{98     \}}
\DoxyCodeLine{99 \};}
\DoxyCodeLine{100 }
\DoxyCodeLine{109 \textcolor{keyword}{template} <\textcolor{keyword}{class} T, \textcolor{keywordtype}{size\_t} CHUNKSHIFT> \textcolor{keyword}{class }\mbox{\hyperlink{class_vector_chunked}{VectorChunked}} \{}
\DoxyCodeLine{110     std::vector<T*> chunks\_;}
\DoxyCodeLine{111     \textcolor{keywordtype}{size\_t} size\_ = 0;}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{size\_t} low\_mask = ((1ULL << CHUNKSHIFT) -\/ 1);}
\DoxyCodeLine{114 }
\DoxyCodeLine{115 \textcolor{keyword}{public}:}
\DoxyCodeLine{116     \mbox{\hyperlink{class_vector_chunked_a53ceef04d9b3ef875eac0e8559f0e65a}{VectorChunked}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{117     \mbox{\hyperlink{class_vector_chunked_ab25abb4c9dc5fe04f060b982cb5ec066}{VectorChunked}}(\textcolor{keyword}{const} \mbox{\hyperlink{class_vector_chunked}{VectorChunked}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{118     \mbox{\hyperlink{class_vector_chunked}{VectorChunked}}\& \mbox{\hyperlink{class_vector_chunked_a7014a32bf307c18c90d5f698492657af}{operator=}}(\textcolor{keyword}{const} \mbox{\hyperlink{class_vector_chunked}{VectorChunked}}\&) = \textcolor{keyword}{delete};}
\DoxyCodeLine{119     \mbox{\hyperlink{class_vector_chunked_aee0f2c7aa30b967edf9d8adaaa54aaa6}{\string~VectorChunked}}() \{}
\DoxyCodeLine{120         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& chunk : chunks\_)}
\DoxyCodeLine{121             \textcolor{keyword}{delete}[] chunk;}
\DoxyCodeLine{122     \}}
\DoxyCodeLine{123 }
\DoxyCodeLine{124     \textcolor{keyword}{const} T\& \mbox{\hyperlink{class_vector_chunked_a6fc64c2e517aa97e9ab3c72c8b4c9984}{operator[]}}(\textcolor{keywordtype}{size\_t} idx)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{125         assert(idx < size\_);}
\DoxyCodeLine{126         \textcolor{keywordflow}{return} chunks\_[idx >> CHUNKSHIFT][idx \& low\_mask];}
\DoxyCodeLine{127     \}}
\DoxyCodeLine{128     T\& \mbox{\hyperlink{class_vector_chunked_a73d1d58aabb6b5cd8ddc6ec59bb6f3f7}{operator[]}}(\textcolor{keywordtype}{size\_t} idx) \{}
\DoxyCodeLine{129         assert(idx < size\_);}
\DoxyCodeLine{130         \textcolor{keywordflow}{return} chunks\_[idx >> CHUNKSHIFT][idx \& low\_mask];}
\DoxyCodeLine{131     \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{class_vector_chunked_a5d0c9d54083c669305be12769ea8f9de}{capacity}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} chunks\_.size() << CHUNKSHIFT; \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{139     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{class_vector_chunked_a467a8f4ce59567a7f4277abb90068d0a}{contiguous}}(\textcolor{keywordtype}{size\_t} pos)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{140         assert(pos < \mbox{\hyperlink{class_vector_chunked_af2f42b26b0af50d3a509f32ed76c90c6}{size}}());}
\DoxyCodeLine{141         \textcolor{keywordflow}{return} 1 + (\string~pos \& low\_mask);}
\DoxyCodeLine{142     \}}
\DoxyCodeLine{143 }
\DoxyCodeLine{146     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{class_vector_chunked_a1af2d1a8e3c767f0351f83f6e12c2e85}{next\_contiguous}}(\textcolor{keywordtype}{size\_t} nElements)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{147         \textcolor{keyword}{const} \textcolor{keyword}{auto} offset = \mbox{\hyperlink{class_vector_chunked_af2f42b26b0af50d3a509f32ed76c90c6}{size}}();}
\DoxyCodeLine{148         \textcolor{keyword}{const} \textcolor{keyword}{auto} \mbox{\hyperlink{class_vector_chunked_a5d0c9d54083c669305be12769ea8f9de}{capacity}} = this-\/>\mbox{\hyperlink{class_vector_chunked_a5d0c9d54083c669305be12769ea8f9de}{capacity}}();}
\DoxyCodeLine{149         \textcolor{keywordflow}{return} \mbox{\hyperlink{class_vector_chunked_a5d0c9d54083c669305be12769ea8f9de}{capacity}} -\/ offset < nElements \textcolor{comment}{// Doesn't fit in the current chunk}}
\DoxyCodeLine{150                    ? \mbox{\hyperlink{class_vector_chunked_a5d0c9d54083c669305be12769ea8f9de}{capacity}}}
\DoxyCodeLine{151                    : offset;}
\DoxyCodeLine{152     \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{159     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_vector_chunked_a192a43efbd9c3a1404d8e36ae7b39b6e}{append}}(\textcolor{keyword}{const} T* src, \textcolor{keywordtype}{size\_t} srcSize, \textcolor{keywordtype}{size\_t} offset) \{}
\DoxyCodeLine{160         assert(offset >= \mbox{\hyperlink{class_vector_chunked_af2f42b26b0af50d3a509f32ed76c90c6}{size}}());}
\DoxyCodeLine{161         \mbox{\hyperlink{class_vector_chunked_a770afcc962ae94744f3e91bc1cda8ad5}{resize}}(offset + srcSize);}
\DoxyCodeLine{162         assert(\mbox{\hyperlink{class_vector_chunked_a467a8f4ce59567a7f4277abb90068d0a}{contiguous}}(offset) >= srcSize);}
\DoxyCodeLine{163         std::copy\_n(src, srcSize, \&\textcolor{keyword}{operator}[](offset));}
\DoxyCodeLine{164     \}}
\DoxyCodeLine{165 }
\DoxyCodeLine{170     \textcolor{keyword}{const} T* \mbox{\hyperlink{class_vector_chunked_aafc0ac87297c4d178ba6568da3f75727}{append}}(\textcolor{keyword}{const} T* src, \textcolor{keywordtype}{size\_t} srcSize) \{}
\DoxyCodeLine{171         \textcolor{keyword}{const} \textcolor{keyword}{auto} offset = \mbox{\hyperlink{class_vector_chunked_a1af2d1a8e3c767f0351f83f6e12c2e85}{next\_contiguous}}(srcSize);}
\DoxyCodeLine{172         \mbox{\hyperlink{class_vector_chunked_a192a43efbd9c3a1404d8e36ae7b39b6e}{append}}(src, srcSize, offset);}
\DoxyCodeLine{173         \textcolor{keywordflow}{return} \&\mbox{\hyperlink{class_vector_chunked_a6fc64c2e517aa97e9ab3c72c8b4c9984}{operator[]}}(offset);}
\DoxyCodeLine{174     \}}
\DoxyCodeLine{175 }
\DoxyCodeLine{176     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_vector_chunked_a19f98140ff68db7aa34f7facd6331407}{push\_back}}(\textcolor{keyword}{const} T\& e) \{}
\DoxyCodeLine{177         \textcolor{keywordtype}{size\_t} idx = size\_;}
\DoxyCodeLine{178         \mbox{\hyperlink{class_vector_chunked_a770afcc962ae94744f3e91bc1cda8ad5}{resize}}(size\_ + 1);}
\DoxyCodeLine{179         \mbox{\hyperlink{class_vector_chunked_a6fc64c2e517aa97e9ab3c72c8b4c9984}{operator[]}}(idx) = e;}
\DoxyCodeLine{180     \}}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_vector_chunked_a770afcc962ae94744f3e91bc1cda8ad5}{resize}}(\textcolor{keywordtype}{size\_t} count) \{}
\DoxyCodeLine{183         size\_ = count;}
\DoxyCodeLine{184         \textcolor{keywordtype}{size\_t} newSize = (count > 0) ? 1 + (count >> CHUNKSHIFT) : 0;}
\DoxyCodeLine{185         \textcolor{keywordtype}{size\_t} chunksSz = chunks\_.size();}
\DoxyCodeLine{186         \textcolor{keywordflow}{if} (newSize == chunksSz)}
\DoxyCodeLine{187             \textcolor{keywordflow}{return};}
\DoxyCodeLine{188 }
\DoxyCodeLine{189         \textcolor{keywordflow}{if} (newSize > chunksSz) \{}
\DoxyCodeLine{190             chunks\_.resize(newSize);}
\DoxyCodeLine{191             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = chunksSz; i < newSize; ++i) \{}
\DoxyCodeLine{192                 chunks\_[i] = \textcolor{keyword}{new} T[1ULL << CHUNKSHIFT];}
\DoxyCodeLine{193             \}}
\DoxyCodeLine{194         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{195             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i = newSize; i < chunksSz; ++i) \{}
\DoxyCodeLine{196                 \textcolor{keyword}{delete}[] chunks\_[i];}
\DoxyCodeLine{197             \}}
\DoxyCodeLine{198             chunks\_.resize(newSize);}
\DoxyCodeLine{199         \}}
\DoxyCodeLine{200     \}}
\DoxyCodeLine{201 }
\DoxyCodeLine{202     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{class_vector_chunked_af2f42b26b0af50d3a509f32ed76c90c6}{size}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} size\_; \}}
\DoxyCodeLine{203 \};}
\DoxyCodeLine{204 }
\DoxyCodeLine{205 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}

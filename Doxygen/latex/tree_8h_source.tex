\hypertarget{tree_8h_source}{}\doxysection{tree.\+h}
\mbox{\hyperlink{tree_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{* Copyright (C) 1999 Shane Hudson}}
\DoxyCodeLine{3 \textcolor{comment}{* Copyright (C) 2015-\/2020 Fulvio Benini}}
\DoxyCodeLine{4 \textcolor{comment}{}}
\DoxyCodeLine{5 \textcolor{comment}{* This file is part of Scid (Shane's Chess Information Database).}}
\DoxyCodeLine{6 \textcolor{comment}{*}}
\DoxyCodeLine{7 \textcolor{comment}{* Scid is free software: you can redistribute it and/or modify}}
\DoxyCodeLine{8 \textcolor{comment}{* it under the terms of the GNU General Public License as published by}}
\DoxyCodeLine{9 \textcolor{comment}{* the Free Software Foundation.}}
\DoxyCodeLine{10 \textcolor{comment}{*}}
\DoxyCodeLine{11 \textcolor{comment}{* Scid is distributed in the hope that it will be useful,}}
\DoxyCodeLine{12 \textcolor{comment}{* but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{13 \textcolor{comment}{* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{14 \textcolor{comment}{* GNU General Public License for more details.}}
\DoxyCodeLine{15 \textcolor{comment}{*}}
\DoxyCodeLine{16 \textcolor{comment}{* You should have received a copy of the GNU General Public License}}
\DoxyCodeLine{17 \textcolor{comment}{* along with Scid.  If not, see <http://www.gnu.org/licenses/>.}}
\DoxyCodeLine{18 \textcolor{comment}{*/}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{fullmove_8h}{fullmove.h}}"{}}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{hfilter_8h}{hfilter.h}}"{}}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{position_8h}{position.h}}"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{27 }
\DoxyCodeLine{28 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_tree_node}{TreeNode}} \{}
\DoxyCodeLine{29     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \mbox{\hyperlink{struct_tree_node_a0548511b945eec4559eeabda05c1e43b}{eloWhiteSum}} = 0;   \textcolor{comment}{// Sum of white Elos.}}
\DoxyCodeLine{30     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \mbox{\hyperlink{struct_tree_node_aed42160b8821a9cc2f800d688456f323}{eloBlackSum}} = 0;   \textcolor{comment}{// Sum of bLack Elos.}}
\DoxyCodeLine{31     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} \textcolor{keywordtype}{long} \mbox{\hyperlink{struct_tree_node_afca18441bc757a7fbbfd6fc99b7d6e4d}{yearSum}} = 0;       \textcolor{comment}{// Sum of years.}}
\DoxyCodeLine{32     \mbox{\hyperlink{common_8h_a2c7f83aec3053cd8fc3ab9a70b7eace7}{gamenumT}} \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[\mbox{\hyperlink{common_8h_a0db83bfcec887261c0320bc2fc5769a6}{NUM\_RESULT\_TYPES}}] = \{\}; \textcolor{comment}{// freq[0] is the total count.}}
\DoxyCodeLine{33     \mbox{\hyperlink{common_8h_a2c7f83aec3053cd8fc3ab9a70b7eace7}{gamenumT}} \mbox{\hyperlink{struct_tree_node_a13da2f7a9e97dfec1a5a0c9bfcea3d09}{eloCount}} = 0;                \textcolor{comment}{// Count of games with an Elo.}}
\DoxyCodeLine{34     \mbox{\hyperlink{common_8h_a2c7f83aec3053cd8fc3ab9a70b7eace7}{gamenumT}} \mbox{\hyperlink{struct_tree_node_ad06dcc5398a4b2634b8016f690105a39}{yearCount}} = 0;               \textcolor{comment}{// Count of games with year != 0.}}
\DoxyCodeLine{35     \mbox{\hyperlink{class_full_move}{FullMove}} \mbox{\hyperlink{struct_tree_node_a8d378a4d89298428342ce91e12f0c543}{move}};}
\DoxyCodeLine{36 }
\DoxyCodeLine{37 \textcolor{keyword}{public}:}
\DoxyCodeLine{38     \textcolor{keyword}{explicit} \mbox{\hyperlink{struct_tree_node_a87186de84363a616327afe2c631b75e0}{TreeNode}}(\mbox{\hyperlink{class_full_move}{FullMove}} m) : \mbox{\hyperlink{struct_tree_node_a8d378a4d89298428342ce91e12f0c543}{move}}(m) \{\}}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{keywordtype}{void} \mbox{\hyperlink{struct_tree_node_aaa869bde4663f6dcc53f273bc48882e5}{add}}(\mbox{\hyperlink{common_8h_acb6fa1964a0822112ce411a072fa6818}{resultT}} result, \textcolor{keywordtype}{int} eloW, \textcolor{keywordtype}{int} eloB, \textcolor{keywordtype}{unsigned} year) \{}
\DoxyCodeLine{41         \textcolor{keyword}{static\_assert}(\mbox{\hyperlink{common_8h_aaa03fe46f271ad4574f8110cbce44b03}{RESULT\_None}} == 0);}
\DoxyCodeLine{42         \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[0]++; \textcolor{comment}{// total count of games}}
\DoxyCodeLine{43         \textcolor{keywordflow}{if} (result != \mbox{\hyperlink{common_8h_aaa03fe46f271ad4574f8110cbce44b03}{RESULT\_None}}) \{}
\DoxyCodeLine{44             \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[result]++;}
\DoxyCodeLine{45         \}}
\DoxyCodeLine{46         \textcolor{keywordflow}{if} (eloW > 0 \&\& eloB > 0) \{}
\DoxyCodeLine{47             ++\mbox{\hyperlink{struct_tree_node_a13da2f7a9e97dfec1a5a0c9bfcea3d09}{eloCount}};}
\DoxyCodeLine{48             \mbox{\hyperlink{struct_tree_node_a0548511b945eec4559eeabda05c1e43b}{eloWhiteSum}} += eloW;}
\DoxyCodeLine{49             \mbox{\hyperlink{struct_tree_node_aed42160b8821a9cc2f800d688456f323}{eloBlackSum}} += eloB;}
\DoxyCodeLine{50         \}}
\DoxyCodeLine{51         \textcolor{keywordflow}{if} (year > 0) \{}
\DoxyCodeLine{52             \mbox{\hyperlink{struct_tree_node_afca18441bc757a7fbbfd6fc99b7d6e4d}{yearSum}} += year;}
\DoxyCodeLine{53             ++\mbox{\hyperlink{struct_tree_node_ad06dcc5398a4b2634b8016f690105a39}{yearCount}};}
\DoxyCodeLine{54         \}}
\DoxyCodeLine{55     \}}
\DoxyCodeLine{56 }
\DoxyCodeLine{59     \textcolor{keywordtype}{int} \mbox{\hyperlink{struct_tree_node_a9c638475e564ad8a489271bfc5967996}{score}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{60         \textcolor{keyword}{auto} n = \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[\mbox{\hyperlink{common_8h_a2203d77b39536657b0a7d765a990ef71}{RESULT\_White}}] + \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[\mbox{\hyperlink{common_8h_a4946769bd12af555df43f7df4a071761}{RESULT\_Draw}}] + \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[\mbox{\hyperlink{common_8h_a9dd5d23bba9930f8ece6be3e7c18d0ad}{RESULT\_Black}}];}
\DoxyCodeLine{61         \textcolor{keyword}{auto} res = 1000ull * \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[\mbox{\hyperlink{common_8h_a2203d77b39536657b0a7d765a990ef71}{RESULT\_White}}] + 500ull * \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[\mbox{\hyperlink{common_8h_a4946769bd12af555df43f7df4a071761}{RESULT\_Draw}}];}
\DoxyCodeLine{62         \textcolor{keywordflow}{return} n ? \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(res / n) : 500;}
\DoxyCodeLine{63     \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{keywordtype}{double} \mbox{\hyperlink{struct_tree_node_ab21eec15b888d834d12a1b84b100afda}{eloPerformance}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{66         \textcolor{keywordflow}{if} (\mbox{\hyperlink{struct_tree_node_a13da2f7a9e97dfec1a5a0c9bfcea3d09}{eloCount}} == 0)}
\DoxyCodeLine{67             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{68 }
\DoxyCodeLine{69         \textcolor{keywordtype}{int} \mbox{\hyperlink{struct_tree_node_a9c638475e564ad8a489271bfc5967996}{score}} = (this-\/>\mbox{\hyperlink{struct_tree_node_a9c638475e564ad8a489271bfc5967996}{score}}() + 5) / 10;}
\DoxyCodeLine{70         \textcolor{keyword}{auto} eloOpp = \mbox{\hyperlink{struct_tree_node_aed42160b8821a9cc2f800d688456f323}{eloBlackSum}};}
\DoxyCodeLine{71         \textcolor{keywordflow}{if} (\mbox{\hyperlink{struct_tree_node_a8d378a4d89298428342ce91e12f0c543}{move}}.\mbox{\hyperlink{class_full_move_a1b5c20d0fb533521d677868fd2823ee1}{getColor}}() != \mbox{\hyperlink{board__def_8h_a4bd880125e6b5752a709bfa88f07e378}{WHITE}}) \{}
\DoxyCodeLine{72             \mbox{\hyperlink{struct_tree_node_a9c638475e564ad8a489271bfc5967996}{score}} = 100 -\/ \mbox{\hyperlink{struct_tree_node_a9c638475e564ad8a489271bfc5967996}{score}};}
\DoxyCodeLine{73             eloOpp = \mbox{\hyperlink{struct_tree_node_a0548511b945eec4559eeabda05c1e43b}{eloWhiteSum}};}
\DoxyCodeLine{74         \}}
\DoxyCodeLine{75         \textcolor{keywordflow}{return} 1.0 * eloOpp / \mbox{\hyperlink{struct_tree_node_a13da2f7a9e97dfec1a5a0c9bfcea3d09}{eloCount}} + FIDE\_ratingTable[\mbox{\hyperlink{struct_tree_node_a9c638475e564ad8a489271bfc5967996}{score}}];}
\DoxyCodeLine{76     \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78     \textcolor{keywordtype}{double} \mbox{\hyperlink{struct_tree_node_a40aa7e466ee83599430156bf9ce48b65}{avgElo}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{79         \textcolor{keywordflow}{if} (\mbox{\hyperlink{struct_tree_node_a13da2f7a9e97dfec1a5a0c9bfcea3d09}{eloCount}} == 0)}
\DoxyCodeLine{80             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \textcolor{keyword}{auto} elo = (\mbox{\hyperlink{struct_tree_node_a8d378a4d89298428342ce91e12f0c543}{move}}.\mbox{\hyperlink{class_full_move_a1b5c20d0fb533521d677868fd2823ee1}{getColor}}() == \mbox{\hyperlink{board__def_8h_a4bd880125e6b5752a709bfa88f07e378}{WHITE}}) ? \mbox{\hyperlink{struct_tree_node_a0548511b945eec4559eeabda05c1e43b}{eloWhiteSum}} : \mbox{\hyperlink{struct_tree_node_aed42160b8821a9cc2f800d688456f323}{eloBlackSum}};}
\DoxyCodeLine{83         \textcolor{keywordflow}{return} 1.0 * elo / \mbox{\hyperlink{struct_tree_node_a13da2f7a9e97dfec1a5a0c9bfcea3d09}{eloCount}};}
\DoxyCodeLine{84     \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86     \textcolor{keywordtype}{double} \mbox{\hyperlink{struct_tree_node_a81079ab5a296dc214708da60f7a9e52a}{avgYear}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \mbox{\hyperlink{struct_tree_node_ad06dcc5398a4b2634b8016f690105a39}{yearCount}} ? 1.0 * \mbox{\hyperlink{struct_tree_node_afca18441bc757a7fbbfd6fc99b7d6e4d}{yearSum}} / \mbox{\hyperlink{struct_tree_node_ad06dcc5398a4b2634b8016f690105a39}{yearCount}} : 0; \}}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     \textcolor{keywordtype}{double} \mbox{\hyperlink{struct_tree_node_a9f7835dcac071238555ec13a8c3e0ac4}{percDraws}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{89         \textcolor{keywordflow}{return} \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[0] ? 100.0 * \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[\mbox{\hyperlink{common_8h_a4946769bd12af555df43f7df4a071761}{RESULT\_Draw}}] / \mbox{\hyperlink{struct_tree_node_aaeb3ed9842ef6158d80b360760feb4e0}{freq}}[0] : 0;}
\DoxyCodeLine{90     \}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92     \textcolor{keyword}{static} \textcolor{keyword}{auto} \mbox{\hyperlink{struct_tree_node_a954c68a7382fa595d87298db6fa808bc}{cmp\_ngames\_desc}}() \{}
\DoxyCodeLine{93         \textcolor{keywordflow}{return}}
\DoxyCodeLine{94             [](\textcolor{keyword}{auto} \textcolor{keyword}{const}\& a, \textcolor{keyword}{auto} \textcolor{keyword}{const}\& b) \{ \textcolor{keywordflow}{return} a.freq[0] > b.freq[0]; \};}
\DoxyCodeLine{95     \}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97 \textcolor{keyword}{private}:}
\DoxyCodeLine{98     \textcolor{comment}{// FIDE table 8.1a of conversion from fractional score (from 0 to 1 with}}
\DoxyCodeLine{99     \textcolor{comment}{// 0.01 increments) into rating differences.}}
\DoxyCodeLine{100     \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{short} FIDE\_ratingTable[] = \{}
\DoxyCodeLine{101         -\/800, -\/677, -\/589, -\/538, -\/501, -\/470, -\/444, -\/422, -\/401, -\/383, -\/366, -\/351,}
\DoxyCodeLine{102         -\/336, -\/322, -\/309, -\/296, -\/284, -\/273, -\/262, -\/251, -\/240, -\/230, -\/220, -\/211,}
\DoxyCodeLine{103         -\/202, -\/193, -\/184, -\/175, -\/166, -\/158, -\/149, -\/141, -\/133, -\/125, -\/117, -\/110,}
\DoxyCodeLine{104         -\/102, -\/95,  -\/87,  -\/80,  -\/72,  -\/65,  -\/57,  -\/50,  -\/43,  -\/36,  -\/29,  -\/21,}
\DoxyCodeLine{105         -\/14,  -\/7,   0,    7,    14,   21,   29,   36,   43,   50,   57,   65,}
\DoxyCodeLine{106         72,   80,   87,   95,   102,  110,  117,  125,  133,  141,  149,  158,}
\DoxyCodeLine{107         166,  175,  184,  193,  202,  211,  220,  230,  240,  251,  262,  273,}
\DoxyCodeLine{108         284,  296,  309,  322,  336,  351,  366,  383,  401,  422,  444,  470,}
\DoxyCodeLine{109         501,  538,  589,  677,  800\};}
\DoxyCodeLine{110 \};}
\DoxyCodeLine{111 }
\DoxyCodeLine{113 \textcolor{comment}{// CompressedFilter class:}}
\DoxyCodeLine{114 \textcolor{comment}{//    Holds the same data as a filter, in compressed format.}}
\DoxyCodeLine{115 \textcolor{comment}{//    Random access to individual values is not possible.}}
\DoxyCodeLine{116 \textcolor{comment}{//    A CompressedFilter is created from, or restored to, a regular}}
\DoxyCodeLine{117 \textcolor{comment}{//    filter with the methods CompressFrom() and UncompressTo().}}
\DoxyCodeLine{118 \textcolor{keyword}{class }\mbox{\hyperlink{class_compressed_filter}{CompressedFilter}} \{}
\DoxyCodeLine{119     \textcolor{keywordtype}{byte}* CompressedData = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{120     \mbox{\hyperlink{common_8h_a2c7f83aec3053cd8fc3ab9a70b7eace7}{gamenumT}} CFilterSize = 0;}
\DoxyCodeLine{121     \mbox{\hyperlink{common_8h_a2c7f83aec3053cd8fc3ab9a70b7eace7}{gamenumT}} CompressedLength = 0;}
\DoxyCodeLine{122 }
\DoxyCodeLine{123 \textcolor{keyword}{public}:}
\DoxyCodeLine{124     \mbox{\hyperlink{class_compressed_filter_a0242d371c17197ce8bd607616b46aa85}{CompressedFilter}}() = \textcolor{keywordflow}{default};}
\DoxyCodeLine{125     \mbox{\hyperlink{class_compressed_filter_ab45720c8253d317b8dbda5dd55b46ce8}{CompressedFilter}}(\mbox{\hyperlink{class_compressed_filter}{CompressedFilter}}\&\&) = \textcolor{keywordflow}{default};}
\DoxyCodeLine{126     \mbox{\hyperlink{class_compressed_filter_a746939e79fc2ced2a638f3b34a2a752b}{\string~CompressedFilter}}() \{ \textcolor{keyword}{delete}[] CompressedData; \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_compressed_filter_ab762af159c1931fef2611b96ed9d7954}{CompressFrom}}(\mbox{\hyperlink{class_filter}{Filter}}* filter);}
\DoxyCodeLine{129     \mbox{\hyperlink{error_8h_a3d30ac5665bf72ba7258c90866c775c0}{errorT}} \mbox{\hyperlink{class_compressed_filter_a0ddf921de7a983b863e8970f6eb689d2}{UncompressTo}}(\mbox{\hyperlink{class_filter}{Filter}}* filter) \textcolor{keyword}{const};}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \textcolor{keyword}{private}:}
\DoxyCodeLine{132     \mbox{\hyperlink{error_8h_a3d30ac5665bf72ba7258c90866c775c0}{errorT}} Verify(\mbox{\hyperlink{class_filter}{Filter}}* filter);}
\DoxyCodeLine{133 \};}
\DoxyCodeLine{134 }
\DoxyCodeLine{135 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_cached_filter}{CachedFilter}} \{}
\DoxyCodeLine{136     \mbox{\hyperlink{class_compressed_filter}{CompressedFilter}} \mbox{\hyperlink{struct_cached_filter_aeb64ca406f11736eba505e29fbd0b6f2}{cfilter\_}};}
\DoxyCodeLine{137     \mbox{\hyperlink{board__def_8h_ac1897395b8e2b8ad9f873b30249f3920}{pieceT}} \mbox{\hyperlink{struct_cached_filter_a225412a953ff44a2b9292db40a681c74}{board\_}}[64];}
\DoxyCodeLine{138     \mbox{\hyperlink{board__def_8h_a392377b3504195ce1ed9148b4f8a3295}{colorT}} \mbox{\hyperlink{struct_cached_filter_a72e49846aa1518873478f4d493f81a7b}{toMove\_}};}
\DoxyCodeLine{139 \};}
\DoxyCodeLine{140 }
\DoxyCodeLine{141 \textcolor{keyword}{class }\mbox{\hyperlink{class_tree_cache}{TreeCache}} \{}
\DoxyCodeLine{142     std::vector<CachedFilter> cache\_;}
\DoxyCodeLine{143     std::vector<uint32\_t> cacheTime\_;}
\DoxyCodeLine{144     uint32\_t cacheTimeCounter\_ = 0;}
\DoxyCodeLine{145 }
\DoxyCodeLine{146 \textcolor{keyword}{public}:}
\DoxyCodeLine{147     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_tree_cache_acd97cca4cc7968c1a8684a93bd2517d9}{Clear}}() \{}
\DoxyCodeLine{148         cache\_.clear();}
\DoxyCodeLine{149         cacheTime\_.clear();}
\DoxyCodeLine{150     \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152     \textcolor{keywordtype}{size\_t} \mbox{\hyperlink{class_tree_cache_af52bf4953f245019c00db224837a2133}{Size}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} cache\_.capacity(); \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154     \textcolor{keywordtype}{void} \mbox{\hyperlink{class_tree_cache_a496c79b4b942d72ce4dccbb80255adec}{CacheResize}}(\textcolor{keywordtype}{size\_t} max\_size) \{}
\DoxyCodeLine{155         \mbox{\hyperlink{class_tree_cache_acd97cca4cc7968c1a8684a93bd2517d9}{Clear}}();}
\DoxyCodeLine{156         cache\_.reserve(max\_size);}
\DoxyCodeLine{157         cacheTime\_.reserve(max\_size);}
\DoxyCodeLine{158     \}}
\DoxyCodeLine{159 }
\DoxyCodeLine{160     \textcolor{keyword}{template} <\textcolor{keyword}{typename} PosT> \textcolor{keywordtype}{void} \mbox{\hyperlink{class_tree_cache_a8ae97fa6ea3f1eacd9791f56362b81ea}{cacheAdd}}(PosT \textcolor{keyword}{const}\& pos, \mbox{\hyperlink{class_filter}{Filter}}\& filter) \{}
\DoxyCodeLine{161         \textcolor{keywordtype}{size\_t} idx;}
\DoxyCodeLine{162         \textcolor{keywordflow}{if} (cache\_.size() < \mbox{\hyperlink{class_tree_cache_af52bf4953f245019c00db224837a2133}{Size}}() || cache\_.empty()) \{}
\DoxyCodeLine{163             idx = cache\_.size();}
\DoxyCodeLine{164             cache\_.emplace\_back();}
\DoxyCodeLine{165             cacheTime\_.emplace\_back();}
\DoxyCodeLine{166         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{167             \textcolor{keyword}{auto} it = std::min\_element(cacheTime\_.begin(), cacheTime\_.end());}
\DoxyCodeLine{168             idx = std::distance(cacheTime\_.begin(), it);}
\DoxyCodeLine{169         \}}
\DoxyCodeLine{170         \textcolor{keyword}{auto} board = pos.GetBoard();}
\DoxyCodeLine{171         std::copy(board, board + 64, cache\_[idx].board\_);}
\DoxyCodeLine{172         cache\_[idx].toMove\_ = pos.GetToMove();}
\DoxyCodeLine{173         cache\_[idx].cfilter\_.CompressFrom(\&filter);}
\DoxyCodeLine{174         cacheTime\_[idx] = cacheTimeCounter\_++;}
\DoxyCodeLine{175     \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177     \textcolor{keyword}{template} <\textcolor{keyword}{typename} PosT>}
\DoxyCodeLine{178     \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_tree_cache_aa74c984dede24b42de851ab30a6e1f2d}{cacheRestore}}(PosT \textcolor{keyword}{const}\& pos, \mbox{\hyperlink{class_filter}{Filter}}\& filter) \{}
\DoxyCodeLine{179         \textcolor{keyword}{auto} it = std::find\_if(}
\DoxyCodeLine{180             cache\_.begin(), cache\_.end(), [\&pos](\textcolor{keyword}{auto} \textcolor{keyword}{const}\& e) \{}
\DoxyCodeLine{181                 return e.toMove\_ == pos.GetToMove() \&\&}
\DoxyCodeLine{182                        std::equal(e.board\_, e.board\_ + 64, pos.GetBoard());}
\DoxyCodeLine{183             \});}
\DoxyCodeLine{184         \textcolor{keywordflow}{if} (it == cache\_.end())}
\DoxyCodeLine{185             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{186 }
\DoxyCodeLine{187         \textcolor{keyword}{auto} idx = std::distance(cache\_.begin(), it);}
\DoxyCodeLine{188         \textcolor{keywordflow}{if} (it-\/>cfilter\_.UncompressTo(\&filter) != \mbox{\hyperlink{error_8h_a97c1af1656bc9df70e86ab103915c98a}{OK}}) \{}
\DoxyCodeLine{189             \mbox{\hyperlink{common_8h_a79da58dac9dcdbcd4005f1d440e363ba}{ASSERT}}(\textcolor{keyword}{false}); \textcolor{comment}{// corrupted data: should not happen}}
\DoxyCodeLine{190             \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{191         \}}
\DoxyCodeLine{192         cacheTime\_[idx] = cacheTimeCounter\_++;}
\DoxyCodeLine{193         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{194     \}}
\DoxyCodeLine{195 \};}

\end{DoxyCode}
